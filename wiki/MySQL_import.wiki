#summary How-to import Wiktionary database into local MySQL database.
#labels MySQL,xml2sql,import

= Introduction =

At this moment, there is more information about import here: [http://synarcher.sourceforge.net synarcher].

= !MediaWiki =
 
My beloved WAMP tutorial pages: 
[http://fastec.altervista.org/Apache_PHP_MySQL.php Ultimate How To], 
[http://www.softtime.ru/article/index.php?id_article=95 in Russian].

Download [http://www.mediawiki.org/wiki/MediaWiki MediaWiki]. Unzip it, e.g. to:
{{{
D:\all\inetpub\mediawiki-1.16.0.enwikt.20100824 
}}}
Open file `httpd.conf`
{{{
gvim "C:\w\Apache Software Foundation\Apache2.2\conf\httpd.conf" 
}}}
Add the following text to `httpd.conf`:
{{{
NameVirtualHost *:80
<VirtualHost *:80>
    DocumentRoot D:/all/inetpub/mediawiki-1.16.0.enwikt.20100824
    ServerName  enwikt
    ErrorLog D:/all/inetpub/logs/wikt_ru_error_log.txt
    CustomLog D:/all/inetpub/logs/wikt_ru_log.txt common
</VirtualHost>
}}}
  * Restart Apache.
  * Open in browser `localhost`.
  * Set up the wiki:
    ** select database name, e.g. `enwikt20100824`.
    ** select storage engine: `MyISAM`.

Add the line: `$wgCapitalLinks=false;` at the end of file `LocalSettings.php`.

= Xml2sql =
Fast upload dump file (e.g. `enwiktionary-20100824-pages-articles.xml`) to MySQL. 

== Errors (Redirect, !DiscussionThreading) ==

=== Intro ===

There are problems with {{{"<redirect />"}}} and {{{"<DiscussionThreading>"}}} in the XML file.

The error message is: 
{{{
./xml2sql unexpected element <redirect> ./xml2sql: parsing aborted at line 33 pos 16.
}}}

=== Solution ===

Strip of the tags (Redirect and DiscussionThreading) by using a perl script [http://wikokit.googlecode.com/svn/trunk/wikt_parser/doc/xml2sql_helper/xml2sql_helper.pl `xml2sql_helper.pl`] with the following format:
{{{
perl xml2sql_helper in_file out_file
}}}
Where `in_file` is `enwiktionary-20100824-pages-articles.xml`.

== Xml2sql ==
Download [http://meta.wikimedia.org/wiki/Xml2sql Xml2sql].
{{{
$ cd /var/lib/mediawiki-1.16.0.enwikt.20100824/
$ bzip2 -d enwiktionary-20100824-pages-articles.xml.bz2
$ xml2sql -m enwiktionary-20100824-pages-articles.xml
}}}
Xml2sql generates three files: page.sql, revision.sql and text.sql

== MySQL ==
{{{
$ mysql -u root -p
USE enwikt20100824
mysql$ SOURCE /temp/page.sql
mysql$ SOURCE /temp/text.sql
mysql$ SOURCE /temp/revision.sql 
}}}

If there is the error (due to `revision.sql`): _"ERROR 1136 (21S01): Column count doesn't match value count at row 1"_, then try the following commands (see [http://www.mediawiki.org/wiki/Talk:Revision_table#Problem%20with%20import%20wiki%20to%20MySQL MediaWiki/Talk:Revision_table]):

remove two fields, load by _SOURCE_, and return (add) two fields back:
{{{
mysql$ ALTER TABLE revision DROP COLUMN rev_len, DROP COLUMN rev_parent_id; 
mysql$ SOURCE /temp/revision.sql
mysql$ ALTER TABLE revision ADD COLUMN rev_len INT(10) UNSIGNED DEFAULT NULL AFTER rev_deleted, ADD COLUMN rev_parent_id INT(10) UNSIGNED DEFAULT NULL AFTER rev_len;
}}}

I do not recommend "SOURCE pagelinks.sql;SOURCE categorylinks.sql;" for very big Wikipedias, e.g. English Wikipedia, see description here [http://synarcher.sourceforge.net/#install_linux Synarcher] (read text after "Tables pagelinks and categorylinks require special attention...").

The result database is ready. It could be used as a source for the Wiktionary parser. Let's dump it into file (just in case):

    * mysqldump --opt -u root -p --compatible=ansi --default-character-set=binary enwikt20100824 > enwikt20100824.sql 

=== Grant privilegies ==
Add the user (e.g. 'javawiki') to MySQL database. Grant privileges at database levels (e.g. 'ruwiki' database). Open MySQL command-line and run commands:
{{{
mysql>CREATE USER javawiki;
mysql>GRANT SELECT ON ruwiki.* TO javawiki@'%';
        (with password; from any computer>GRANT SELECT PRIVILEGES ON ruwiki.* TO javawiki identified by '12345')
mysql>FLUSH PRIVILEGES;
}}}

= Next step =
  * [File_wikt_parsed_empty_sql Load empty Wiktionary parsed database into MySQL]

= See also ==
  * [categorylinks]

== Links ==
  * [http://meta.wikimedia.org/wiki/Talk:Xml2sql Talk:Xml2sql (meta)]
  * [http://synarcher.sourceforge.net How to solve problems with import of revision.sql]. Search the line: ALTER TABLE revision 